---
import jobsData from '../../data/jobs.json'

// Sort jobs from most recent to oldest
const sortedJobs = [...jobsData].sort((a, b) => {
  // Determine the comparison date for each job
  const getComparisonDate = (job) => {
    if (job.End && /[a-zA-Z]/.test(job.End)) {
      // "Present" or other text -> use current date
      return new Date()
    } else if (job.End) {
      // Has an end date -> use it
      return new Date(job.End)
    } else {
      // No end date (like awards) -> use start date
      return new Date(job.Start)
    }
  }

  const dateA = getComparisonDate(a)
  const dateB = getComparisonDate(b)
  return dateB - dateA
})
---

<h2
  class="-mb-4 text-4xl font-extrabold tracking-tight text-left border-b border-blue-400 xl:-mb-24 md:pb-4 xl:mt-16 xl:text-6xl border-opacity-20"
>
  Work Experience
</h2>

{sortedJobs.map((job) => (
  <div class="container mx-auto my-8 mt-16 lg:mt-44">
    <div class="flex flex-col lg:mt-16 lg:flex-row">
      <div class="w-full lg:w-[38%] flex flex-col justify-between">
        <div class="flex flex-col justify-between pr-8">
          <div class="flex flex-col items-baseline justify-between sm:flex-row lg:flex-col">
            <h1 class="text-2xl font-extrabold tracking-tighter lg:text-3xl xl:text-5xl">
              {job.Title}
            </h1>
            <p class="pt-2 pr-8 text-xs text-gray-400 lg:text-sm lg:pt-20 xl:text-base">
              {job.Start}{job.End ? ` – ${job.End}` : ''}
            </p>
          </div>
          <ul class="flex flex-wrap mt-3 text-xs lg:-ml-1 lg:space-x-1 sm:text-sm lg:text-base">
            {job.Keywords?.map((keyword) => (
              <li class="block px-2 py-0 mx-1 mb-2 mr-1 text-sm font-light text-blue-300 duration-500 bg-transparent border border-blue-400 rounded-full lg:mr-0 lg:py-1 hover:bg-blue-600 hover:text-white hover:border-transparent">
                {keyword}
              </li>
            ))}
          </ul>
        </div>
        <div class="w-[62%] bg-whitex bg-opacity-10 rounded flex items-end">
        </div>
      </div>
      <div class="flex flex-col justify-between flex-1 text-2xl font-light bg-blue-800x items-left">
        <h3 class="pt-2 pb-2 text-2xl font-thin border-blue-400 lg:pt-4 lg:mt-4 lg:border-t lg:text-3xl xl:text-4xl border-opacity-20">
          {job.Company}
        </h3>
        <ul class="flex flex-col pt-2 text-base lg:pt-4 sm:text-base gap-y-1 2xl:text-xl">
          {job.Bullets?.map((bullet) => (
            <li>• {bullet}</li>
          ))}
        </ul>
      </div>
    </div>
  </div>
))}
