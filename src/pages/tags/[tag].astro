---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogPost from '../../layouts/BlogPost.astro';

import ButtonAura from '../../components/atoms/ButtonAura.astro'

import { getCollection } from "astro:content";

export async function getStaticPaths() {

    // This come MUST be in the scope of getStaticPaths()
    const allPosts = await getCollection("blog");
      
    // Get a list of all unique tags that exist
    const uniqueTags = [...new Set(allPosts.map((post) => post.data.tags).flat())];

    // 
    return uniqueTags.map((tag) => {
        const filteredPosts = allPosts.filter((post) =>
            post.data.tags.includes(tag)
        );
        return {
            params: { tag },
            props: { posts: filteredPosts },
        };
    });
}

const { tag } = Astro.params;
const { posts } = Astro.props;

---
<BaseLayout pageTitle={tag}>

    <!-- <div class="py-24 bg-gray-900 sm:py-32">
    <div class="px-6 mx-auto max-w-7xl lg:px-8">

        <div class="max-w-2xl mx-auto lg:max-w-4xl">

            <h2 class="text-4xl font-semibold tracking-tight text-white text-pretty sm:text-5xl">More about: <span class="underline">{ tag }</span></h2>
            <p class="mt-2 text-gray-400 text-lg/8">Posts tagged with: <span class="underline">{ tag }</span></p>

            <div class="mt-16 space-y-20 lg:mt-20">
            { posts.map((post) => (

                <article class="relative flex flex-col gap-8 isolate lg:flex-row">
                <div class="relative aspect-video sm:aspect-2/1 lg:aspect-square lg:w-64 lg:shrink-0">
                    <img src={post.data.image.url} alt={post.data.image.alt} class="absolute inset-0 object-cover bg-gray-800 size-full rounded-2xl" />
                    <div class="absolute inset-0 rounded-2xl inset-ring inset-ring-white/10"></div>
                </div>
                <div>
                    <div class="flex items-center text-xs gap-x-4">
                        <time datetime="2020-03-16" class="text-gray-400">{ post.data.pubDate }</time>
                    </div>
                    <div class="relative max-w-xl group">
                    <h3 class="mt-3 text-2xl font-semibold text-white group-hover:text-gray-300">
                        <a href={`/posts/${post.id}/`}>
                            <span class="absolute inset-0"></span>
                            { post.data.title }
                        </a>
                    </h3>
                    <p class="mt-3 text-gray-400 text-sm/6">
                        { post.data.description }
                    </p>
                    </div>
                    <div class="flex gap-2 pt-6 mt-6 text-xs border-t border-white/10">
                        { post.data.tags.map( ( tag ) => (
                            <a href={`/tags/${tag}`} class="relative z-10 rounded-full bg-gray-800/60 px-3 py-1.5 font-medium text-gray-300 hover:bg-gray-800">
                                { tag }
                            </a>
                        ) ) }
                    </div>
                </div>
                </article>

            ) ) }
            </div>
        </div>

    </div>
    </div> -->

    <div class="py-24 bg-gray-900 sm:py-32">
        <div class="px-6 mx-auto max-w-7xl lg:px-8">
            <div class="max-w-2xl mx-auto">
                <h2 class="text-4xl font-semibold tracking-tight text-white text-pretty sm:text-5xl">
                    More about: <span class="underline">{ tag }</span>
                </h2>
                <p class="mt-2 text-gray-300 text-lg/8">
                    Posts tagged with: <span class="underline">{ tag }</span>
                </p>
                <div class="pt-10 mt-10 space-y-16 border-t border-gray-700 sm:mt-16 sm:pt-16">

                    { posts.map((post) => (

                        <article class="relative flex flex-col gap-8 isolate lg:flex-row">
                            <a href={`/posts/${post.id}/`}>
                                <div class="relative aspect-video sm:aspect-2/1 lg:aspect-square lg:w-64 lg:shrink-0">
                                    <img src={post.data.image.url} alt={post.data.image.alt} class="absolute inset-0 object-cover bg-gray-800 size-full rounded-2xl" />
                                    <div class="absolute inset-0 rounded-2xl inset-ring inset-ring-white/10"></div>
                                </div>
                            </a>
                            <div>
                                <div class="flex items-center mt-3 text-xs gap-x-4">
                                    <time datetime="2020-03-16" class="text-gray-400">{ post.data.pubDate.toDateString() }</time>
                                </div>
                                <div class="relative max-w-xl group">
                                <h3 class="mt-3 text-2xl font-semibold text-white group-hover:text-gray-300">
                                    <a href={`/posts/${post.id}/`}>
                                        <span class="absolute inset-0"></span>
                                        { post.data.title }
                                    </a>
                                </h3>
                                <p class="mt-3 text-gray-400 text-sm/6">
                                    { post.data.description }
                                </p>
                                </div>
                                <div class="flex gap-2 pt-6 mt-6 text-xs border-t border-white/10">
                                    { post.data.tags.map( ( tag ) => (
                                        <a href={`/tags/${tag}`} class="relative z-10 rounded-full bg-gray-800/60 px-3 py-1.5 font-medium text-gray-300 hover:bg-gray-800">
                                            { tag }
                                        </a>
                                    ) ) }
                                </div>
                            </div>
                        </article>

                    ) ) }

                </div>
            </div>
        </div>
        <div class="flex items-center justify-center gap-4 pt-44">
            <ButtonAura link="/tags" label="Back to Tags Page" />
            <ButtonAura link="/blog" label="Back to Blog" />
        </div>
    </div>
  

</BaseLayout>
