---
import BaseLayout from './BaseLayout.astro'

/**
 * Portfolio Item Layout
 * Uses prose styling system like blog posts
 * Supports rich content with case studies, external links, and social sharing
 */

interface Props {
  frontmatter: {
    title: string;
    description?: string;
    image: string;
    tags: string[];
    pubDate?: Date;
    contentType?: string;
    caseStudyUrl?: string;
    externalUrl?: string;
    externalLabel?: string;
    links?: Array<{
      label: string;
      url: string;
      icon?: string;
    }>;
  };
  slug?: string;
}

const { frontmatter, slug } = Astro.props;
const { title, description, image, tags, pubDate, contentType, caseStudyUrl, externalUrl, externalLabel, links = [] } = frontmatter;

// Generate share URL for social media
const currentUrl = slug ? `https://astro-marcus.netlify.app/portfolio/${slug}` : '';
---

<BaseLayout pageTitle={title}>
    <div class="prose bg-gray-900">
        <div class="prose-content">
            <!-- Tags as intro -->
            {tags && tags.length > 0 && (
                <p class="font-semibold text-indigo-400 text-base/7">{tags.join(', ')}</p>
            )}

            <!-- Main title -->
            <h1>{title}</h1>

            <!-- Meta information -->
            {pubDate && (
                <p class="text-gray-400 text-sm mt-4">
                    Published on {pubDate.toDateString()}
                </p>
            )}

            <!-- Description/excerpt as lead paragraph -->
            {description && (
                <p class="text-xl/8">{description}</p>
            )}

            <!-- Hero image -->
            {image && (
                <figure class="mt-10">
                    <img src={image} alt={title} class="w-full aspect-video object-cover bg-gray-800 rounded-xl" />
                </figure>
            )}

            <!-- External link or case study CTA -->
            {contentType === 'case-study' && caseStudyUrl && (
                <div class="mt-8">
                    <a href={caseStudyUrl}
                       class="inline-block px-6 py-3 text-sm font-semibold text-white bg-indigo-500 rounded-lg hover:bg-indigo-600 transition-colors no-underline"
                       target="_blank">
                        Read Full Case Study →
                    </a>
                </div>
            )}

            {contentType === 'external' && externalUrl && (
                <div class="mt-8">
                    <a href={externalUrl}
                       class="inline-block px-6 py-3 text-sm font-semibold text-white bg-indigo-500 rounded-lg hover:bg-indigo-600 transition-colors no-underline"
                       target="_blank">
                        {externalLabel || 'View Project'} →
                    </a>
                </div>
            )}

            <!-- Main content (markdown body) -->
            <div class="max-w-2xl mt-10">
                <slot />
            </div>

            <!-- Additional links (social, GitHub, live demo, etc.) -->
            {links.length > 0 && (
                <div class="mt-16 pt-8 border-t border-gray-700">
                    <p class="text-sm font-semibold text-gray-400 mb-4">Project Links:</p>
                    <ul class="flex flex-wrap gap-2 list-none mt-0 space-y-0">
                        {links.map(link => (
                            <li class="m-0">
                                <a href={link.url}
                                   class="inline-block px-3 py-1 text-sm bg-teal-500/10 text-teal-400 rounded-full border border-teal-500/20 hover:bg-teal-500/20 no-underline transition-colors"
                                   target="_blank">
                                    {link.label}
                                </a>
                            </li>
                        ))}
                    </ul>
                </div>
            )}

            <!-- Tags at bottom (clickable) -->
            {tags && tags.length > 0 && (
                <div class="mt-16 pt-8 border-t border-gray-700">
                    <p class="text-sm font-semibold text-gray-400 mb-4">Tags:</p>
                    <ul class="flex flex-wrap gap-2 list-none mt-0 space-y-0">
                        {tags.map((tag) => (
                            <li class="m-0">
                                <a href={`/tags/${tag}`} class="inline-block px-3 py-1 text-sm bg-indigo-500/10 text-indigo-400 rounded-full border border-indigo-500/20 hover:bg-indigo-500/20 transition-colors no-underline">
                                    {tag}
                                </a>
                            </li>
                        ))}
                    </ul>
                </div>
            )}
        </div>
    </div>
</BaseLayout>